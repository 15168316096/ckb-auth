# ckb-auth litecoin interoperability

Ckb-auth library is able to verify a lot of blockchain signatures including the litecoin.
We can use `litecoin-cli` (or other compatible wallet) to generate valid transactions and validate them on-chain with ckb-auth.

We need to sign the message with your litecoin private key. The message to be signed is the ASCII hex representation of
the transaction hash. This signing process is itself straightforward. But we may to do some serialization/deserialziation
works for the message, private key and signature.

## Signing the transaction
In the following section, we assume the private key to signing message is the environment variable `$KEY`
whose corresponding litecoin address is `$ADDRESS`, and the message to sign is the transaction hash `$MESSAGE`.
An example of those data is 
```
export KEY="cQoJiU5ECnVpRqfV5dWKDE2sLQq6516Tja1Hb1GABUV24n7WkqV4" ADDRESS="mhknqLHQGWDXuLsPdzab8nA4jD3fMdVYS2" MESSAGE="29553f9e37fa16e45f1d3e616ac5366f6afd9936477f2d6fc870f49bdf540157"
```

### Get the transaction hash
You need to construct a skeleton transaction and obtain the transaction hash. See [Tutorial | Lumos](https://lumos-website.vercel.app/#5-create-a-transfer-transaction) for a example to do such thing with Lumos.

### Import the private key into the litecoin wallet
Say we want to import the key into the wallet `ckb-auth-test-wallet` with label `ckb-auth-test-privkey`, we can run
`litecoin-cli -rpcwallet=ckb-auth-test-wallet -testnet importprivkey "$KEY" ckb-auth-test-privkey false`.
One thing to note is that the private key `$KEY` should be in the [Wallet import format](https://en.bitcoin.it/wiki/Wallet_import_format).

### Get the address corresponding to the private key in order to signing
TODO: Maybe this is overly-complex. Do we have a simpler way?

Note that due to the deprecation of address in old format ([upstream bitcoin did this](https://river.com/learn/terms/h/hd-wallet)). Only the address format presented here works for `signmessage` and `verifymessage` RPC. This is found out by trial and error. I have found no easy way to obtain such address from the private key. Currently we obtain the address by first dumping the wallet, and then obtain the relevant line
```
cQoJiU5ECnVpRqfV5dWKDE2sLQq6516Tja1Hb1GABUV24n7WkqV4 1970-01-01T00:00:01Z label=ckb-auth-test-privkey # addr=mhknqLHQGWDXuLsPdzab8nA4jD3fMdVYS2,QjpdvL4h5jnfaj1uV5ifJNUAYZTTbjgFH5,tltc1qrz8z67vtu38pq2yzqtq7unftmsaueq6a8da5n2,tmweb1qqfgxqndkjczrcv2k6gc0f8jmzsug358j2dpf8t0dxe4jaheu3swp5qemjfm7c2v7gt5sl5snf9kr6tygl3t773l6spt4cmuel4d92m038gkysq8d
```
where the address `mhknqLHQGWDXuLsPdzab8nA4jD3fMdVYS2` works for `signmessage` and `verifymessage`.
A simple shell command would be `litecoin-cli -rpcwallet=ckb-auth-test-wallet -testnet dumpwallet /tmp/ltc-wallet; sed -En "/$KEY.*addr=.*/ s#.*addr=([^,]*).*#\1#p" /tmp/ltc-wallet`.

### Signing the message
Signing is easier after obtained the wallet address and imported the private key. Running
`SIGNATURE="$(litecoin-cli -rpcwallet=ckb-auth-test-wallet -testnet signmessage "$ADDRESS" "$MESSAGE")"` is enough.
You can also verify the result with `litecoin-cli -rpcwallet=ckb-auth-test-wallet -testnet verifymessage "$ADDRESS" "$SIGNATURE" "$MESSAGE"`.

### Deserialize the base64 signature
The signature generated by litecoin-cli is in the base64 form. To use it on-chain,
you may need to deserialize into the binary data.
